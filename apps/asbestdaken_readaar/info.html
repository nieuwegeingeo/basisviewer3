

<body>
<div class="feature-counter__container">
    <label>Aantal objecten: <span class="feature-counter" style="font-size:16px; font-weight:bold;" type="text" /></span>
    </div>
<p>Gebruik de knoppen om te filteren</p>


<div class="filter-container">
    <div class="input-eigenaar_type">
    <div class="input-container">
            <label class="jaar-input__label">Jaar van: <input onkeyup="setFilter()" class="jaar-input__input" type="text" name="jaar_van" value="1900"/></label>
            <br>
            <label class="jaar-input__label">Jaar tot: <input onkeyup="setFilter()" class="jaar-input__input" type="text" name="jaar_tot" value="2020"/></label>
        </div>
    </div>
    <br>
    <div class="input-verdacht">
        <div class="input-container">
            <label class="filterInput checkbox-aan"><input class="checkbox-all" type="checkbox" name="oordeel-alles" checked="true" />Alle typen</label>
        </div>
        <div class="breakline"><br></div>
        <div class="input-container flex-wrapper">
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="oordeel" type="checkbox" value="niet verdacht" checked="true" />Niet verdacht</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="oordeel" type="checkbox" value="deels niet zichtbaar','niet zichtbaar" checked="true" />(Deels) niet zichtbaar</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="oordeel" type="checkbox" value="deels verdacht golfplaat','deels verdacht leisteen" checked="true" />Deels verdacht</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="oordeel" type="checkbox" value="verdacht golfplaat','verdacht leisteen" checked="true" />Verdacht</label>   

            
        </div>
        
    </div>
    <br>
    <div class="breakline"></div>
    <div class="input-eigenaar_type">
        <div class="input-container">
            <label class="filterInput checkbox-aan"><input class="checkbox-all" type="checkbox" name="eigenaar_type-alles" checked="true" />Alle eigenaren</label>
        </div>
        <div class="breakline"><br></div>
        <div class="input-container flex-wrapper">
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="eigenaar_type" type="checkbox" value="Wooncorporatie" checked="true" />Wooncorporatie</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="eigenaar_type" type="checkbox" value="Gemeente Nieuwegein" checked="true" />Gemeente Nieuwegein</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="eigenaar_type" type="checkbox" value="Particulier" checked="true" />Particulier</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="eigenaar_type" type="checkbox" value="onbekend" checked="true" />Onbekend</label>
        </div>
        
    </div>
    <br>
    <div class="breakline"><br></div>
    <div class="input-gebruik_type">
        <div class="input-container">
            <label class="filterInput checkbox-aan"><input class="checkbox-all" type="checkbox" name="gebruik_type-alles" checked="true" />Alle gebruik</label>
        </div>
        <div class="breakline"><br></div>
        <div class="input-container flex-wrapper">
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="gebruik_type" type="checkbox" value="wonen" checked="true" />Woonfunctie</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="gebruik_type" type="checkbox" value="gecombineerd" checked="true" />Gecombineerd</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="gebruik_type" type="checkbox" value="overige" checked="true" />Niet woonfunctie</label>
            <label class="filterInput checkbox-aan"><input class="filter-checkbox" name="gebruik_type" type="checkbox" value="schuur" checked="true" />Schuur</label>
        </div>
        
    </div>
    <br>
    
</div>

<script>


var format = new OpenLayers.Format.CQL();

    $('.checkbox-all').click(function() {
        var clickedBox = this;
        var clickedName = clickedBox.name;
        var childBoxes = $('[name="'+clickedName.replace('-alles','')+'"]');
       if (clickedBox.checked === true) {
            $(clickedBox).parent().addClass('checkbox-aan');
            $(childBoxes).prop('checked', true);
            $(childBoxes).parent().addClass('checkbox-aan');
        } else {
            $(clickedBox).parent().removeClass('checkbox-aan');
            $(childBoxes).prop('checked', false);
            $(childBoxes).parent().removeClass('checkbox-aan');
        }
        setFilter()
    })       
        
    $('.filter-checkbox').click(function() {
        var clickedBox = this;
        var clickedName = clickedBox.name;
        var totalBoxes = $('[name="' + clickedName + '"]').length;
        var parentBox = $('[name="' + clickedName + '-alles' + '"]');
        
       if (clickedBox.checked === true) {
            
            var boxCount = 0;
            
            $.each($('[name="' + clickedName + '"]'), function(index, item) {
                if (item.checked === true) { boxCount++;}
            })
            
            $(clickedBox).parent().addClass('checkbox-aan');
            if (boxCount === totalBoxes) {            
                $(parentBox).prop('checked', true);
                $(parentBox).parent().addClass('checkbox-aan');
            }
        } else {
            $(clickedBox).parent().removeClass('checkbox-aan');
            $(parentBox).prop('checked', false);
            $(parentBox).parent().removeClass('checkbox-aan');
        }
        setFilter()
    }) 
        
    var cqlFilter = '';      
    
    
    function setFilter() {
        
        var oordeelIn = '';
        var eigenaarIn = '';
        var gebruikIn = '';
        var oordeelFilter = '';
        var eigenaarFilter = '';
        var gebruikFilter = '';
        var layers = Geogem.map.layers;
        

        $.each($('[name="oordeel"'), function(index, item) {
            if (item.checked === true && oordeelIn === '') {
                if (item.value.match(',')) {                    
                    var split = item.value.split(',');                    
                    oordeelIn = "OORDEEL IN" + " ('" + split[0] + "," + split[1];
                    oordeelFilter = "(OORDEEL = '" + split[0] + " OR OORDEEL = "+ split[1] + "'"
                } else {
                    oordeelIn = "OORDEEL IN" + " ('" + item.value;
                    oordeelFilter = "(OORDEEL = '" + item.value + "'";
                }
            } else if (item.checked === true && oordeelIn !== '') {
                oordeelIn = oordeelIn + "','" + item.value;
                if (item.value.match(',')) {
                    var split = item.value.split(',');
                    $.each(split, function(index, splt) {
                        oordeelFilter = oordeelFilter + " OR OORDEEL = '" + splt.replace("'","") + "'";
                    })
                } else {
                    oordeelFilter = oordeelFilter + " OR OORDEEL = '" + item.value + "'";
                }                
            } 
        })
        if (oordeelIn === '') {
            oordeelIn = "OORDEEL IN ('')"
            oordeelFilter = "OORDEEL = ''";
        } else {
            oordeelIn = oordeelIn + "')"
            oordeelFilter =  oordeelFilter + ')';
        }
        
        $.each($('[name="eigenaar_type"'), function(index, item) {
            if (item.checked === true && eigenaarIn === '') {
                if (item.value.match(',')) {console.log('match')}
                eigenaarIn = "E_TYPE IN" + " ('" + item.value;
                eigenaarFilter = "(E_TYPE = '" + item.value + "'";
            } else if (item.checked === true && eigenaarIn !== '') {
                eigenaarIn = eigenaarIn + "','" + item.value;
                if (item.value.match(',')) {
                    var split = item.value.split(',');
                    $.each(split, function(index, splt) {
                        eigenaarFilter = eigenaarFilter + " OR E_TYPE = '" + splt.replace("'","") + "'";
                    })
                } else {
                    eigenaarFilter = eigenaarFilter + " OR E_TYPE = '" + item.value + "'";
                }  
                
            } 
        })
        
        if (eigenaarIn === '') {
            eigenaarIn = "E_TYPE IN ('')"
            eigenaarFilter = "E_TYPE = ''";
        } else {
            eigenaarIn = eigenaarIn + "')"
            eigenaarFilter =  eigenaarFilter + ')';
        }
        
        $.each($('[name="gebruik_type"'), function(index, item) {
            if (item.checked === true && gebruikIn === '') {
                if (item.value.match(',')) {console.log('match')}
                gebruikIn = "GEBRUIK IN" + " ('" + item.value;
                gebruikFilter = "(GEBRUIK = '" + item.value + "'";
            } else if (item.checked === true && gebruikIn !== '') {
                gebruikIn = gebruikIn + "','" + item.value;
                if (item.value.match(',')) {
                    var split = item.value.split(',');
                    $.each(split, function(index, splt) {
                        gebruikFilter = gebruikFilter + " OR GEBRUIK = '" + splt.replace("'","") + "'";
                    })
                } else {
                    gebruikFilter = gebruikFilter + " OR GEBRUIK = '" + item.value + "'";
                }  
                
            } 
        })
        
        if (gebruikIn === '') {
            gebruikIn = "GEBRUIK IN ('')"
            gebruikFilter = "GEBRUIK = ''";
        } else {
            gebruikIn = gebruikIn + "')"
            gebruikFilter =  gebruikFilter + ')';
        }
      
        
        var yearFilter = ''
        var yearMin = $('[name="jaar_van"]')[0].value;
        var yearMax = $('[name="jaar_tot"]')[0].value;
        if ($.isNumeric(yearMin) != true) {yearMin = 1900; $('[name="jaar_van"]')[0].value = 1900;}
        if ($.isNumeric(yearMax) != true) {yearMax = 2018; $('[name="jaar_tot"]')[0].value = 2020;}
        yearFilter = " AND (BOUWJAAR BETWEEN " + yearMin + " AND "+ yearMax + ") ";

        cqlFilter = oordeelIn + ' AND ' + eigenaarIn + ' AND ' + gebruikIn + yearFilter;
        wfsFilter = oordeelFilter + ' AND ' + eigenaarFilter + ' AND ' + gebruikFilter + yearFilter;
        console.log(wfsFilter)
        $.each(layers, function(index, item) {
            if (item.options.filter === true) {
                item.params.CQL_FILTER = cqlFilter;
                item.redraw();
            }
            if (item.id.match(/vector/gi)) {
                var filter = format.read(wfsFilter,0);
                wfsRule.filter = filter;                
                item.redraw();                    
            }
        })
        countFeatures();
        }
               

    var countFeatures = function(){   
        var url = 'http://geodev.nieuwegein.nl/geoserver/wfs?request=GetFeature&typeName=asbestdaken_readaar_app&version=1.1.0&resultType=hits&';
        if (cqlFilter != '') {
            url = url + 'CQL_FILTER=' + cqlFilter;
            url = url.replace(/%/g, '%25' )
        }   

        $.get(url, function(xml) {
            var response = $(xml.documentElement.attributes)
            for (var i = 0, len = response.length; i < len; i++ ) {
                if (response[i].name == 'numberOfFeatures') {
                    var featureNumber = response[i].nodeValue;
                    $('.feature-counter').prop('innerHTML', featureNumber)
                }
            }
            //var featureNumber = response[7].nodeValue;
            //$('.feature-counter').prop('innerHTML', featureNumber)
        })
        
        
    }
    setTimeout(countFeatures(), 2000);
        
        
        
 </script>
</body>   
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
   <!--
    var filterType = '';
    var filterCatEigenaar = 'E_TYPE';
    var filterCatOordeel = 'OORDEEL';

    
    var arrayValuesEigenaar = [];
    var arrayValuesOordeel = [];
    var arrayFiller = function(type) {
        arrayValues = [];
        $('[name="' + type + '"]').map(function(index, item) {
            arrayValues.push("'" + item.value + "'")
        })
    }
    
    var filterLayer = [];
    Geogem.map.layers.map(function(layer) {
        if (layer.options.filter) {
            filterLayer.push(layer)
        }
    })
    
    var resetFilter = function() {
        $.each(filterLayer, function(index, item){
            item.params.CQL_FILTER = undefined;
            item.redraw();
        })
        $.each($('.filter-checkbox, .checkbox-all'), function(index, item) {
            itemParent = $(item).parent();
            item.checked = true;
            if (!$(itemParent).hasClass('checkbox-aan')) {
                $(itemParent).addClass('checkbox-aan')
            }
        })
    }
    
    setCategorie = function() {
        //filterCat = $('.filter-categorie').prop('value');
        if (filterCat == 'E_TYPE') {
            filterType = 'eigenaar_type';
            arrayFiller(filterType);
            resetFilter()
        } else if (filterCat == 'CATEGORIE') {
            filterType = 'categorie';
            arrayFiller(filterType);
            resetFilter()
        } else if (filterCat == 'HOOFDGROEP') {
            filterType = 'hoofdgroep';
            arrayFiller(filterType);
            resetFilter()
        } else if (filterCat == 'OORDEEL') {
            filterType = 'oordeel';
            arrayFiller(filterType);
            resetFilter()
        }
        $('.input-' + filterType + '').show().siblings().hide();
    }
    
    /*function listSearch() {
        var listSearchbox = $('.feature-filter');
        var listFilter = listSearchbox.prop('value').toLowerCase();            
        var listSearchFilter = function(code) {
            filterLayer.map(function(layer) {
                layer.params.CQL_FILTER = "strToLowerCase(" + filterCat + ") LIKE '%"+ code +"%'";
                layer.redraw();
            });
        }
        listSearchFilter(listFilter);
    }*/

    var filterArray = [];    
    var filterStore = [];
    
    var layerFilter = '';
    var addLayerFilter = function() {
        layerFilter = ' AND( ';
        $.each($('.layer-switcher__input'), function(index, input){            
            if (input.checked === true){
                var layer = Geogem.map.getLayersByName(input.name)[0];
                if(layer.options.cql_filter) {
                    var filter = layer.options.cql_filter + ' OR ';
                    layerFilter = layerFilter.concat(filter);
                }
            }
        })
        if (layerFilter.length == 5) {
            layerFilter = '';
        } else {
            layerFilter = layerFilter.slice(0, -3);
            layerFilter = layerFilter + ')' 
        }
        $.each(Geogem.map.layers, function(index, layer){layer.redraw();});        
    }
    
    var yearFilter = ''
    
    var addYearFilter =  function() {
        var yearMin = $('[name="jaar_van"]')[0].value;
        var yearMax = $('[name="jaar_tot"]')[0].value;
        if ($.isNumeric(yearMin) != true) {yearMin = 1900; $('[name="jaar_van"]')[0].value = 1900;}
        if ($.isNumeric(yearMax) != true) {yearMax = 2018; $('[name="jaar_tot"]')[0].value = 2018;}
        yearFilter = " AND( BOUWJAAR BETWEEN " + yearMin + " AND "+ yearMax + ") ";
        
    }

    $.each($('.layer-switcher__input'), function(index, input){ 
        //console.log(input)
        $(input).change( function(){
            filterLayerFunction(filterArray)
            //addLayerFilter();
        })
    })
    
    
    $.each($('.filter-checkbox'), function() {
            filterArray.push("'"+ $(this).prop('value')+ "'") ;    
            $(this).parent().addClass('checkbox-aan');
    });
    
    var totalFilter = '';
    var filterLayerFunction = function(array) {
        filterLayer.map(function(layer) {    
            layer.params.CQL_FILTER = filterCat + " IN ("+ array +")";
            addLayerFilter();
            addYearFilter()
            layerFilter = layerFilter.concat(yearFilter);
            layer.params.CQL_FILTER = layer.params.CQL_FILTER.concat(layerFilter);
            totalFilter = layer.params.CQL_FILTER;
            //console.log(layer.params.CQL_FILTER)
            layer.redraw();
            countFeatures()
        });
    }
    
    $('.checkbox-all').on('click', function(e) {
    
        var name = $(this).attr('name').replace('-alles','');
        console.log(name)
        if ($(this).prop('checked') === true) {
        if ($(this).attr('name') === 'eigenaar_type-alles') {
            filterArray = ["'Wooncorporatie'","'Gemeente Nieuwegein'","'Particulier'","'onbekend'"];
            console.log(filterArray);
        }   else if ($(this).attr('name') === 'oordeel-alles') {
            filterArray = ["'Niet verdacht'","'Niet zichtbaar'","'Niet zichtbaar'","'Deels verdacht'","'Verdacht'"];
            console.log(filterArray);
        }         //arrayValues;
            $('.filter-checkbox[name="' + name + '"]').prop('checked', true);                
           filterLayerFunction(filterArray);
            $('.filterInput[name="' + name + '"]').addClass('checkbox-aan');
            } else {
            filterArray = ["''"];
            $('.filter-checkbox[name="' + name + '"]').prop('checked', false);
            filterLayerFunction(filterArray);
            $('.filterInput[name="' + name + '"]').removeClass('checkbox-aan');
        } 
        
        
    });
    $('.filter-checkbox').on('click', function(e) {
        inputValue = "'"+ $(this).prop('value')+ "'";
        if ($(this).prop('checked') === true) {
            filterArray.push(inputValue);
            valueIndex = filterArray.indexOf(inputValue);                
            filterLayerFunction(filterArray);
            $(this).parent().addClass('checkbox-aan');
            if (filterArray.length == 6){$('.checkbox-all').prop('checked', true).parent().addClass('checkbox-aan');}
        } else {
            valueIndex = filterArray.indexOf(inputValue);
            filterArray.splice(valueIndex, 1);
            $('.checkbox-all').prop('checked', false);
            $(this).parent().removeClass('checkbox-aan');
            $('.checkbox-all').parent().removeClass('checkbox-aan');
            if (filterArray.length === 0) {
                filterArray = ["''"];
                filterLayerFunction(filterArray);
            } else {
                filterLayerFunction(filterArray);
            }
        }
    });
    
    if (filterStore.length != 0) {
        filterArray = filterStore;
    }

    var countFeatures = function(){   
        var url = 'http://gng-ap713.nieuwegein.nl/geoserver/wfs?request=GetFeature&typeName=asbestdaken_readaar_app&version=1.1.0&resultType=hits&';
        if (totalFilter != '') {
            url = url + 'CQL_FILTER=' + totalFilter;
            url = url.replace(/%/g, '%25' )
        }   

        $.get(url, function(xml) {
            var response = $(xml.documentElement.attributes)
            for (var i = 0, len = response.length; i < len; i++ ) {
                if (response[i].name == 'numberOfFeatures') {
                    var featureNumber = response[i].nodeValue;
                    $('.feature-counter').prop('innerHTML', featureNumber)
                }
            }
            //var featureNumber = response[7].nodeValue;
            //$('.feature-counter').prop('innerHTML', featureNumber)
        })
        
        
    }
    setTimeout(countFeatures(), 2000);
        
    -->
